<html>
        <head>
                <title>Run SQL queries on CSV files - Beta.</title>
                <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

        </head>
        <body>
                <div>This is a preview. In the upcoming releases, this page allows users to upload CSV files and query them. The current version only queries an existing csv file with generated random values</div>
                <b>Query: </b><font face="courier new" size='1.5em'>select * from mycsv1.csv</font>
                <div id='sql-result'>
                </div>
                <input type="button" class="next-page" value="Next page >"> </input>
        </body>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
        <script type="text/javascript">
                $(document).ready(function(){
                let handle="";
                function updateTable(result){
                        $('#sql-result').html("");
                        var tableRows=JSON.parse("[" + result.result.substring(0,result.result.lastIndexOf(",")) + "]");
                        let table=$("<table class='table-hover table-striped table' id='results'>");
                        let tableHeader=$("<thead class='thead-dark'>");
                        let headerCells=tableRows[0].columnValues;
                          for (let j = 0 ; j < headerCells.length; j++) {
                                $(tableHeader).append($("<th scope='col'>" + headerCells[j] + "</th>"));
                          }
                        table.append(tableHeader);
                        for (let i=1 ; i < tableRows.length; i++) {
                                let row = $("<tr>");
                                let cells = tableRows[i].columnValues;

                                for (let j = 0 ; j < cells.length; j++) {
                                        row.append($("<td>" + cells[j] + "</td>"));
                                }
                                $(table).append(row);
                        }

                        $('#sql-result').append(table);
                }
                function getNext() {
                  $.post({url: "https://zni50a8iy6.execute-api.us-east-1.amazonaws.com/default/csvsql",
                        data: handle === undefined || handle === "" ? "{\"sql\":\"select * from s3://mycsv1.csv\"}" : "{\"handle\":\"" + handle + "\"}",
                        headers: {"Content-Type":"application/json"},
                        success: function(result){
                                handle = result.handle;
                                updateTable(result);
                        }});
                }
                $('.next-page').click(function(event) { getNext() });

                });
        </script>

</html>
